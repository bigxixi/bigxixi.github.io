<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<script src="js/gsap.min.js"></script>
        <style>
            *{
                margin: 0 auto;
                padding: 0 auto;
            }
            .fullpage{
                background: transparent;
                width: 100vw;
                height: 100vh;
                display: block;
                overflow: hidden;
                position: relative;
            }
            .textInfo{
                left: 0;
                top:0;
                width: 100%;
                height: 100%;
                display: block;
                position: absolute;
                text-align: center;
                font-size: 20vw;
                color:black;
            }
            .page2{
                background:transparent;
                background-size: cover;
                left: 0;
                top:0;
                width: 100%;
                height: 100%;
                display: block;
                overflow: hidden;
                position: absolute;
            }
        </style>
	</head>
	<body>
		<div class="fullpage">
            <div class="textInfo p1textInfo" style="background:burlywood;">ç‚¹å‡»é¡µé¢<br>ç¿»  é¡µ</div>
			<div class="page2 maskTest">
				<canvas class="p2BG"></canvas>
				<div class="p2Contents" style="opacity: 0;">
					<div class="textInfo p2textInfo" style="display:none;">ç¬¬äºŒé¡µ</div>
				</div>
			</div>

		</div>
		
		<script>
            //è®¾ç½®ç”»å¸ƒå®½é«˜
			let cWidth = window.innerWidth;
			let cHeight = window.innerHeight;

			//è·å–éœ€è¦åŠ¨ç”»çš„domèŠ‚ç‚¹
			let fullpage = document.querySelector('.fullpage');
            let p1textInfo = document.querySelector(".p1textInfo");
			let p2textInfo = document.querySelector('.p2textInfo');
			let p2Contents = document.querySelector('.p2Contents');

			//ç¿»é¡µåŠ¨ç”»
            //æ¯ä¸ªç‚¹åˆå§‹xä½ç½®åœ¨å±å¹•å³ä¾§ä¹Ÿå³yä½ç½®æŒ‰ç…§é¡µé¢é«˜åº¦åˆ†å‰²
			let ySplit = [0,cHeight*0.5,cHeight];
			let points = {
				p1:{x:cWidth,y:ySplit[0]},
				p2:{x:cWidth,y:ySplit[1]},
				p3:{x:cWidth,y:ySplit[2]},
				p4:{x:cWidth,y:ySplit[2]},
				p5:{x:cWidth,y:ySplit[0]},
			};
            //ç®€åŒ–è´å¡å°”æ§åˆ¶ç‚¹è®¡ç®—
            //è®©æ§åˆ¶ç‚¹å¹³è¡Œæˆ–è€…å‚ç›´äºå¯¹åº”é¡¶ç‚¹ï¼Œè·ç¦»ç›¸ç­‰çš„ä½ç½®
            //å‡½æ•°è¿”å›ä¸¤ä¸ªæ§åˆ¶ç‚¹çš„xyåæ ‡
			let cps = cHeight*0.2;//è®¾ç½®æ§åˆ¶ç‚¹è·ç¦»
			function cPoints(point,dir,s){
				let c1x=0;
				let c1y=0;
				let c2x=0;
				let c2y=0;
				switch (dir) {
					case "v":
						c1x = point.x;
						c1y = point.y-s;
						c2x = point.x;
						c2y = point.y+s;
						break;
					case "h":
						c1x = point.x-s;
						c1y = point.y;
						c2x = point.x+s;
						c2y = point.y;
						break;
					default:
						break;
				}
				return [c1x,c1y,c2x,c2y]
			}

            //è®¾ç½®ç¿»é¡µåŠ¨ç”»çš„ canvas å®½é«˜
			let p2bg = document.querySelector('.p2BG');
				p2bg.width = cWidth;
				p2bg.height = cHeight;
			let p2ctx = p2bg.getContext('2d');

			//ç»˜åˆ¶å¸ƒå¸˜
			function drawCloth_transPage(){
				p2ctx.clearRect(0,0,p2bg.width,p2bg.height);
				p2ctx.fillStyle = 'lightGray';
				p2ctx.beginPath();
				p2ctx.moveTo(points.p1.x, points.p1.y);

                //p1-p2,p2-p3ä¸ºè´å¡å°”æ›²çº¿
                //ç”»å¸ƒä¸­ç»˜åˆ¶è´å¡å°”æ›²çº¿çš„æ–¹æ³•
                //bezierCurveTo(
                    // p1(èµ·å§‹é¡¶ç‚¹)çš„æ§åˆ¶ç‚¹2çš„xï¼Œ
                    // p1çš„æ§åˆ¶ç‚¹2çš„yï¼Œ
                    // p2(ä¸‹ä¸€ä¸ªé¡¶ç‚¹)çš„æ§åˆ¶ç‚¹1çš„xï¼Œ
                    // p2çš„æ§åˆ¶ç‚¹1çš„yï¼Œ
                    // p2çš„xï¼Œ
                    // p2çš„y);
                
				p2ctx.bezierCurveTo(
                    points.p1.x, points.p1.y,
					cPoints(points.p2,"v",cps)[0], 
					cPoints(points.p2,"v",cps)[1], 
					points.p2.x, points.p2.y);
				p2ctx.bezierCurveTo(
					cPoints(points.p2,"v",cps)[2], 
					cPoints(points.p2,"v",cps)[3], 
                    points.p3.x, points.p3.y,
					points.p3.x, points.p3.y);

                //å‰©ä¸‹çš„p3-p4,p4-p5,p5-p1æ˜¯ç›´çº¿ï¼Œç”¨ lineTo é“¾æ¥ä¸¤ä¸ªé¡¶ç‚¹å°±å¯ä»¥äº†
				p2ctx.lineTo(points.p4.x, points.p4.y);
				p2ctx.lineTo(points.p5.x, points.p5.y);
				p2ctx.closePath();
				p2ctx.fill();
                //é€šè¿‡requestAnimationFrameæ¯å¸§ä¸æ–­ç»˜åˆ¶
				requestAnimationFrame(drawCloth_transPage)
			}
			drawCloth_transPage();

			// ç‚¹å‡»æ—¶ç¿»é¡µ
			fullpage.addEventListener("click",(e)=>{
                p2textInfo.style = "display:none;"

                //ç¿»é¡µè¿‡ç¨‹ä¸­ç¦æ­¢ç‚¹å‡»ï¼Œæ¼”ç¤ºç”¨
                fullpage.style="pointer-events:none;";
                
                //å¸ƒå¸˜æ‹‰å‡ºåŠ¨ç”»
                //è¿™é‡Œä½¿ç”¨äº†ç°æˆçš„ gsap åŠ¨ç”»åº“ï¼Œè¯¦æƒ…æ„Ÿå…´è¶£å¯ä»¥å»å®˜ç½‘äº†è§£
                //https://greensock.com/docs/v3/GSAP
                //å…¶å®ç”¨åˆ°çš„åŠŸèƒ½ä¸å¤šï¼Œå¦‚æœè¿½æ±‚æ›´è½»é‡çš„ä½“ç§¯å¯ä»¥è‡ªå·±æ‰‹æ’¸ä¸€ä¸ªï¼Œæ­¤å¤„æš‚ä¸èµ˜è¿°
                //åˆ›å»ºä¸€ä¸ªã€Œæ—¶é—´çº¿ã€
                const clothWave = gsap.timeline();
                      clothWave.fromTo(
                        points.p2, //è¦åŠ¨ç”»çš„ç‚¹
                        {
                            x:cWidth, //åˆå§‹å€¼
                        },
                        {
                            x:0,//åŠ¨ç”»ç»“æŸå€¼
                            duration: 0.5,//åŠ¨ç”»ç”¨æ—¶
                            ease: "ease-in"//ç¼“åŠ¨æ–¹å¼
                        }).to(//ç„¶åå¼€å§‹å¼¹æ€§åŠ¨ç”»
                            points.p2, 
                            {
                                duration:0.2,
                                x:cWidth*0.05, //ç¨å¾®å¾€ğŸ‘‰ğŸ»ä½ç§»ä¸€ä¸¢ä¸¢
                                ease: "ease-out"
                            }
                        ).to(
                            points.p2, 
                            {
                                duration:0.2,
                                x:0, //å†å¾€å·¦æ‹‰å›
                                ease: "ease-in"
                            }
                        ).to(
                            points.p2, 
                            {
                                duration:0.2,
                                x:cWidth*0.015, //å†æ¬¡ç¨å¾®å¾€ğŸ‘‰ğŸ»ä½ç§»ä¸€ä¸¢ä¸¢ä¸¢ä¸¢
                                ease: "ease-out"
                            }
                        ).to(
                            points.p2, 
                            {
                                duration:0.2,
                                x:0, //å†æ¬¡å¾€å·¦æ‹‰å›
                                ease: "ease-in",
                                onComplete:()=>{
                                    //åŠ¨ç”»å®Œæˆåï¼Œæ¢å¤é¡µé¢å¯ç‚¹å‡»æ€§
                                    fullpage.style="pointer-events:auto;";
                                    document.body.querySelector(".page2").style="pointer-events:auto;";
                                }
                            }
                        );
                     clothWave.play();

                //æ³¢å½¢åŠ¨ç”»å®Œæˆåï¼Œpage2å†…å®¹é€æ˜åº¦çš„å‡ºç°åŠ¨ç”»ï¼Œ
                p2textInfo.style = "display:block;"
                gsap.fromTo(
                    p2Contents,
                    {
                        opacity:0,
                    },
                    {
                        opacity:1,
                        duration: 0.2,
                        delay:0.7,
                        onComplete:()=>{
                            //p2å†…å®¹å‡ºç°åæ•ˆæœã€‚å¦‚æœæœ‰éœ€è¦ï¼Œå¯ä»¥åœ¨è¿™é‡ŒæŠŠç¬¬ä¸€é¡µçš„å†…å®¹é”€æ¯äº†ï¼Œæˆ–è€…é™éŸ³
                        }
                    })
                //å…¶ä»–ç‚¹çš„åŠ¨ç”»
                gsap.fromTo(points.p1,{x:cWidth,
                    },{x:0,delay:0.1,duration: 0.5,ease: "ease-in",
                    });
                gsap.fromTo(points.p3,{x:cWidth, 
                    },{x:0,delay:0.1,duration: 0.5,ease: "ease-in",
                    });
			},{passive:true})			
		</script>
	</body>
</html>