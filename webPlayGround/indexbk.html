<!--Generated via AE2CSS by BigXiXi-->
<!DOCTYPE html>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="chrome=1,IE=edge" />
<meta name="viewport" content="target-densitydpi=device-dpi,width=1242,user-scalable=no" /> 
<title>JYYX</title>
<head>
        <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
        <script>
                (function(global){var startY=0;var enabled=false;var supportsPassiveOption=false;try{var opts=Object.defineProperty({},"passive",{get:function(){supportsPassiveOption=true}});window.addEventListener("test",null,opts)}catch(e){}var handleTouchmove=function(evt){var el=evt.target;while(el!==document.body&&el!==document){var style=window.getComputedStyle(el);if(!style){break}if(el.nodeName==="INPUT"&&el.getAttribute("type")==="range"){return}var scrolling=style.getPropertyValue("-webkit-overflow-scrolling");var overflowY=style.getPropertyValue("overflow-y");var height=parseInt(style.getPropertyValue("height"),10);var isScrollable=scrolling==="touch"&&(overflowY==="auto"||overflowY==="scroll");var canScroll=el.scrollHeight>el.offsetHeight;if(isScrollable&&canScroll){var curY=evt.touches?evt.touches[0].screenY:evt.screenY;var isAtTop=startY<=curY&&el.scrollTop===0;var isAtBottom=startY>=curY&&el.scrollHeight-el.scrollTop===height;if(isAtTop||isAtBottom){evt.preventDefault()}return}el=el.parentNode}evt.preventDefault()};var handleTouchstart=function(evt){startY=evt.touches?evt.touches[0].screenY:evt.screenY};var enable=function(){window.addEventListener("touchstart",handleTouchstart,supportsPassiveOption?{passive:false}:false);window.addEventListener("touchmove",handleTouchmove,supportsPassiveOption?{passive:false}:false);enabled=true};var disable=function(){window.removeEventListener("touchstart",handleTouchstart,false);window.removeEventListener("touchmove",handleTouchmove,false);enabled=false};var isEnabled=function(){return enabled};var testDiv=document.createElement("div");document.documentElement.appendChild(testDiv);testDiv.style.WebkitOverflowScrolling="touch";var scrollSupport="getComputedStyle"in window&&window.getComputedStyle(testDiv)["-webkit-overflow-scrolling"]==="touch";document.documentElement.removeChild(testDiv);if(scrollSupport){enable()}var iNoBounce={enable:enable,disable:disable,isEnabled:isEnabled};if(typeof module!=="undefined"&&module.exports){module.exports=iNoBounce}if(typeof global.define==="function"){(function(define){define("iNoBounce",[],function(){return iNoBounce})})(global.define)}else{global.iNoBounce=iNoBounce}})(this);
            
            
            </script>
    <style>
/*---Div Structure---

<div id="comp">
<div id="id3_JYYX"></div>
<div id="id2_icons"></div>
<div id="id1_disk"></div>
</div>

*/
*{
    margin: 0 auto;
    padding: 0 auto;
}
html{
    position: relative;
    width:100%;
    height:100%;
}
body{
    width:100%;
    height: 100%;
    position: relative;
    margin: 0 auto;
    padding: 0;
}
#comp{
    background: transparent;
    width: 1242px;
    height: 2208px;
    display: block;
    overflow: hidden;
    position: relative;
    transform: translate3D(0,0,0) scale(1,1);
    transform-origin:50% 0%;
}
#id3_JYYX{
    background: url("imgs/JYYX.png");
    left: 0px;
    top: 0px;
    width: 1242px;
    height: 2208px;
    transform: translate3D(0,0,0) scale(1,1);
transform-origin:50% 50%;
    overflow: hidden;
    display: block;
    position: absolute; 
}
#id2_icons{
    background: url("imgs/icons.png");
    left: 0px;
    top: 0px;
    width: 1242px;
    height: 2208px;
    transform: translate3D(0,0,0) scale(1,1);
transform-origin:50% 50%;
    overflow: hidden;
    display: block;
    position: absolute; 
}
#id1_disk{
    background: url("imgs/pan.png");
    left: 260.5px;
    top: 562px;
    width: 721px;
    height: 721px;
    transform: translate3D(0,0,0) scale(1,1);
transform-origin:50% 50%;
    overflow: hidden;
    display: block;
    position: absolute; 
    animation: rot 20s linear infinite;
}

@keyframes rot{
    0% {
        transform: translate3D(0,0,0) scale(1,1) rotate(0);
    }
    100%{
        transform: translate3D(0,0,0) scale(1,1) rotate(360deg);
    }
}

#can{
    left: 0px;
    top: 0px;
    width: 1242px;
    height: 2208px;
    transform: translate3D(0,0,0) scale(1,1);
transform-origin:50% 50%;
    overflow: hidden;
    display: block;
    position: absolute; 
}
    </style>
</head>
<body>
<div id="comp">
<div id="id3_JYYX"></div>
<div id="id2_icons"></div>
<canvas id="can"></canvas>
<div id="id1_disk"></div>
<!-- <audio id="myAudio"></audio> -->
</div>
<script>
    var hh=window.innerHeight;
    var ww=window.innerWidth;
    var rr=hh/2208;
    var offset=(2208*rr-hh)/2;

    // var discCx = ww/2;
    // var discCy = 751*rr;
//https://test1-1256995298.cos.ap-shanghai.myqcloud.com/test/llsr.mp3
    // var jiaodu = 0;
    // var pan = document.getElementById('disk');

    // var cdm = document.getElementById('cd');
    
    var comp=document.getElementById('comp');
    var can=document.getElementById("can");
        can.setAttribute("width","1242");
        can.setAttribute("height","2208");
     var points = 9;


    function drawLine(arr,step){
        var lColor = '#000000';
        var lWidth = 5;
        var lR = 450;
        var angle = 2*Math.PI/points;
        var ctx=can.getContext("2d");

        ctx.beginPath();
        ctx.lineWidth = lWidth; 
        ctx.strokeStyle = lColor;
        //ctx.arc(621,922.5,lR,0,2*Math.PI);
        function ofs(i){
            var lRt = lR+arr[i*step];
            var xx=lRt*Math.sin(i*angle)+621;
            var yy=lRt*Math.cos(i*angle)+922.5;
            console.log('___________'+[xx,yy]);
            return [xx,yy];
            
        }

        for(var i=0;i<points;i++){
            if(i==0){
                ctx.moveTo(ofs(i)[0],ofs(i)[1]);
            }else if(i==points-1){
                ctx.lineTo(ofs(i)[0],ofs(i)[1]);
                ctx.lineTo(ofs(0)[0],ofs(0)[1]);
            }else{
                ctx.lineTo(ofs(i)[0],ofs(i)[1]);
            }

        }

        //ctx.bezierCurveTo(75,37,70,25,50,25);


        ctx.stroke();
    }

    drawLine([0],0);



    window.onload = function(){
        // console.log(offset+'\n'+rr);
        // console.log('translate3D(0,'+offset+'px,0) scale('+rr+');');
        //comp.style.opacity = '0.5';
        comp.style.transform = 'translate3D(0,'+offset+'px,0) scale('+rr+')';
        //comp.style.WebkitTransform = 'translate3D(0,-'+offset.toFixed(2)+'px,0) scale('+rr+');';
    }  
    document.body.addEventListener("touchstart", load, false);
   // document.body.addEventListener("click", load, false);

function load(){
        // document.getElementById('id1_封面图').className = 'rotate';
        var url='assets/llsr.mp3';
        var ctx = new (window.AudioContext || window.webkitAudioContext)();
        
        // document.body.addEventListener('touchstart', function() {
        //     ctx.resume().then(() => {
        //         console.log('Playback resumed successfully');
        //     });
        // });
        // var source = null;
         //使用Ajax获取音频文件

        var request = new XMLHttpRequest();
        request.open('GET', url, true);
        request.responseType = 'arraybuffer';//配置数据的返回类型
        //加载完成
        
        request.onload = function (){    
            var arraybuffer = request.response;
            ctx.decodeAudioData(arraybuffer, function (buffer) {
                //创建分析器
                var analyser = ctx.createAnalyser();
                source = ctx.createBufferSource();
                //将source与分析器链接
                source.connect(analyser);
                //将分析器与destination链接，这样才能形成到达扬声器的通路
                analyser.connect(ctx.destination);
                //将解码后的buffer数据复制给source
                source.buffer = buffer;
                //播放
                source.start(0);
                console.log('0000');

                //第一层——————————————————————————————
                function drawSpectrum() {
                    var array = new Uint8Array(analyser.frequencyBinCount);
                    analyser.getByteFrequencyData(array);
                    //console.info(array.length);
                    var meterNum = points;//几个采样点
                    var step = Math.round(array.length/meterNum)//计算从analyser中的采样步长
                    var divider = 2000;
                    var theM = 150*window.innerHeight/2436;
                    var theN = 150*window.innerHeight/2436;
                    var dData="";
                    theR = 430;
                    var pp=[];
                    var pIn=[];
                    var pOut=[];

                    console.log(array);

                    drawLine(array,step);

                    //分段，求各个点坐标
                    // for(var i=0;i<meterNum;i++){
                    //     var degrees = 10+360/meterNum * i;
                    //     var kTemp = Math.tan(degrees * Math.PI/180);
                    //     if(kTemp == 0){
                    //         kTemp = 0.01;
                    //     }
                    //     var theK = -1/kTemp;
                    //     var deg = 360/meterNum * i;
                    //     //var curP=[theR+theR*Math.cos(degrees * Math.PI/180),theR+theR*Math.sin(degrees * Math.PI/180)];
                    //     var curPin,curPout;
                    //     if(deg<360 && deg>180){
                    //         curPin=[InOut(curP[0],curP[1],theK,theM,theN)[2],InOut(curP[0],curP[1],theK,theM,theN)[3]];
                    //         curPout=[InOut(curP[0],curP[1],theK,theM,theN)[0],InOut(curP[0],curP[1],theK,theM,theN)[1]];
                    //     }else{
                    //         curPin=[InOut(curP[0],curP[1],theK,theM,theN)[0],InOut(curP[0],curP[1],theK,theM,theN)[1]];
                    //         curPout=[InOut(curP[0],curP[1],theK,theM,theN)[2],InOut(curP[0],curP[1],theK,theM,theN)[3]];
                    //     }

                    //     // var curPin=curP
                    //     // var curPout=curP
                    //     pp.push(curP);
                    //     pIn.push(curPin);
                    //     pOut.push(curPout);
                    // }
                    // //转换成path数据
                    // for(var j=0;j<pp.length;j++){
                    //     var multX=multY=1;
                    //     var degCheck = 360/meterNum * j;
                    //     multX = (array[j*step]/divider)*Math.cos(degCheck * Math.PI/180);
                    //     multY = (array[j*step]/divider)*Math.sin(degCheck * Math.PI/180);

                    //     //theR + theR*(array[j*step]/divider)*Math.sin(degCheck * Math.PI/180) - pp[j][1];
                    //     var multXtemp,multYtemp;
                    //     if(j == 0){
                    //         multXtemp = multX;
                    //         multYtemp = multY;
                    //         dData += "M"+pp[j][0]*(1+multX)+","+pp[j][1]*(1+multY)+
                    //                 " C"+pOut[j][0]*(1+multX)+","+pOut[j][1]*(1+multY)+
                    //                 " "+pIn[j+1][0]*(1+multX)+","+pIn[j+1][1]*(1+multY)+
                    //                 " "+pp[j+1][0]*(1+multX)+","+pp[j+1][1]*(1+multY)+" ";
                    //     }else if(j == pp.length-1){
                    //         multX = multXtemp;
                    //         multY = multYtemp;
                    //         dData += "C"+pOut[j][0]*(1+multX)+","+pOut[j][1]*(1+multY)+
                    //                 " "+pIn[0][0]*(1+multX)+","+pIn[0][1]*(1+multY)+
                    //                 " "+pp[0][0]*(1+multX)+","+pp[0][1]*(1+multY)+"Z";
                    //         }else if(j%2 == 0){
                    //         dData += "C"+pOut[j][0]*(1+multX/2)+","+pOut[j][1]*(1+multY/2)+
                    //                 " "+pIn[j+1][0]*(1+multX/2)+","+pIn[j+1][1]*(1+multY/2)+
                    //                 " "+pp[j+1][0]*(1+multX/2)+","+pp[j+1][1]*(1+multY/2)+" ";
                    //         }else{
                    //         dData += "C"+pOut[j][0]*(1+multX)+","+pOut[j][1]*(1+multY)+
                    //                 " "+pIn[j+1][0]*(1+multX)+","+pIn[j+1][1]*(1+multY)+
                    //                 " "+pp[j+1][0]*(1+multX)+","+pp[j+1][1]*(1+multY)+" ";
                    //     }

                        
                    // }
                     
                    // var theWave = document.getElementById('waveTest');
                    //     theWave.setAttribute('d',dData);


                    requestAnimationFrame(drawSpectrum)
                }
                //第一层—end—————————————————————————————
                requestAnimationFrame(drawSpectrum)
            }, function (e) {
                console.info('处理出错');
            });
            request.send();
    }

    
}

</script>
</body>
</html>
